
<body>

<div id="left">

    Enter your annual income:
    <br>
    <input placeholder="Enter income" id="income" type="text" value=""></input>

    <div>You are the
    <span id="percentile">X</span>
    percent.</div>

</div>

<div id="right">
    <div>Ok, so say you make <span id="incomeText"></span>.</div>
    <br>

    <div>You are among the top
    <span id="groupsize">_</span> out of
    <span id="popsize"></span> American wage earners.
    </div>

    <br>
    <div class="percentbox">
        <div id="percentbar"></div>
    </div>

    <br>
    <div>There are 
    <span id="restsize">_</span> people who make less than you.
    </div>

    <br>
    <div class="percentbox">
        <div id="percentbar2"></div>
    </div>

    <br>
    <div>That is an hourly rate of <span id="hourly"></span> per hour.
    </div>
    <br>
    <div>The median income is <span id="median"></span> which is an hourly rate of
    <span id="medianrate"></span>. Your income is <span id="medianmultiple"></span> times
    the median. It would take you <span id="medianhours"></span> hours (<span id="mediandays"></span> work days
    or <span id="medianyears"></span> years) to make the median annual income.</div>

    <br>
    <div>Try typing in <span id="poverty"></span>. That is the poverty line.
    <br>

    <div>Try typing in <span id="elite"></span> (that's a million).</div>

    <br>
    <div>Try typing in <span id="billion"></span> (that's a billion).</div>

    <div>I would like to provide some perspective and insight into the actual numbers around income inequality
    and a way to visualize that. It is difficult to grasp the orders of magnitude.</div>

    <br>
    <div>This is the income distribution in the US.</div>

</div>

</body>

<style>
* {
    font-family: Helvetica;

}

body{
    width: 750px;
    margin: auto;
    margin-top: 100px;
}

#left{
    float: left;
    width: 400px;
    font-size: 30px;
}

#right{
    float: left;
    width: 350px;
    height: 100%;
    overflow: scroll;
    font-size: 20px;
}

input{
    padding: 3px;
    margin: 4px;
    font-size: 30px;

}

.percentbox{
    width: 300px;
    height: 20px;
    border: 1px solid black;
}

#percentbar{
    width: 0%;
    height: 100%;
    background-color: black;
}

#percentbar2{
    width: 0%;
    height: 100%;
    background-color: black;
    float: right;
}

</style>

<script src="./jquery.min.js"></script>
<script src="./papaparse.min.js"></script>

<script>

// This it the target population, in millions
var POPULATION = 158186786;

// This is the number of working hours.
var HOURS_PER_DAY = 8;
var DAYS_PER_WEEK = 5;
var WEEKS_PER_YEAR = 52;
var WORKING_HOURS = HOURS_PER_DAY * DAYS_PER_WEEK * WEEKS_PER_YEAR;

// Median income
var MEDIAN_INCOME = 28851;

// This is the starting income for the visualization
var DEFAULT_INCOME = MEDIAN_INCOME;

// Poverty line
var POVERTY_INCOME = 11770;

// Elite line
var ELITE_INCOME = 1000000;

// Billion line
var BILLION_INCOME = 1000000000;

var MIN_INDEX = 4;
var MAX_INDEX = 5;
// This is the 1st index of the array, which is the percentile
var PERCENT_INDEX = 3;

function english(n){
    if(n > 1e6){
        return (n / 1e6).toFixed(3) + " million ";
    }
    return parseInt(n.toFixed(0)).toLocaleString();
}


// http://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript
function to$(n){
    return n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
}

Number.prototype.round = function(places) {
  return +(Math.round(this + "e+" + places)  + "e-" + places);
}

function toMoney(n, short){
    var x = to$(n);
    if(short){
        return "$" + x.substring(0, x.length - 3);
    }

    return "$" + x;
}

$(document).ready(function(){

    var data = Papa.parse(
        $("#datatable").html()
    ).data;
    console.log(data);

    for(var i = 0; i < data.length; i++){
        var cur = data[i];
        console.log(cur);
        var range = cur[0].replace(/,/g, '');
        var splits = range.split("^");
        console.log(splits);

        var min = parseFloat(splits[0]);
        var max = parseFloat(splits[1]);
        console.log(min)
        console.log(max);

        cur.push(min);
        cur.push(max);

        var cleanPercent = parseFloat(cur[PERCENT_INDEX].replace('%', ''));
        cleanPercent = cleanPercent.round(5);

        cur[PERCENT_INDEX] = cleanPercent;

        console.log(cur);

    }


    // Set the population
    $("#popsize").text(english(POPULATION));

    // Set the default income
    $("#income").val(DEFAULT_INCOME);

    function round(num){
        return Math.floor(num * 100) / 100;
    }

    function compute(income){
        console.log("calc" + income);
        // Default to 100 percent if less than all cutoffs.
        var percent = 0.0001;

        for(var i = 0; i < data.length; i++){
            var cur = data[i];
            console.log(i + " " + cur[MIN_INDEX] + " " + cur[MAX_INDEX] + " " + cur[PERCENT_INDEX]);
            if(income >= cur[MIN_INDEX] && income <= cur[MAX_INDEX]){
                percent = cur[PERCENT_INDEX];
            }
        }

        // Set the percentile text
        $("#percentile").text(percent);
        $("#incomeText").text(toMoney(income,true));

        // Calculate and set the group size
        var groupsize = percent / 100.0 * POPULATION;


        $("#groupsize").text(english(groupsize));

        // Format the progress bar
        $("#percentbar").css('width', percent + '%');

        $("#percentbar2").css('width', (100 - percent) + '%');

        // Set the size of the rest of the population
        var rest = english(POPULATION - groupsize);
        $("#restsize").text(rest);

        var hourlyRate = income / WORKING_HOURS;
        $("#hourly").text(toMoney(hourlyRate));

        $("#median").text(toMoney(MEDIAN_INCOME, true));
        var medianRate = toMoney(MEDIAN_INCOME / WORKING_HOURS);
        $("#medianrate").text(medianRate);

        var medianMultiple = income / MEDIAN_INCOME;
        $("#medianmultiple").text(medianMultiple.toFixed(5));

        var hoursToMakeMedian = WORKING_HOURS / medianMultiple;
        var daysToMakeMedian = hoursToMakeMedian / HOURS_PER_DAY;
        var yearsToMakeMedian = 1 / medianMultiple;
        $("#medianhours").text(hoursToMakeMedian.round(4));
        $("#mediandays").text(daysToMakeMedian.round(4));
        $("#medianyears").text(yearsToMakeMedian.round(4));

        $("#poverty").text(toMoney(POVERTY_INCOME, true));
        $("#elite").text(toMoney(ELITE_INCOME, true));
        $("#billion").text(toMoney(BILLION_INCOME, true));
    }

    // When they enter a key, recalculate.
    $("#income").keyup(function(e){
        var val = $(this).val();
        val = val.replace(/,/g, '');

        var amount = parseInt(val) || 0;
        compute(amount);
    });

    // Calculate initially with the default values
    compute(DEFAULT_INCOME);
});

</script>



<div id="datatable" style="display:none">"0.01 ^ 4,999.99",22574440,158186786,100.00%
"5,000.00 ^ 9,999.99","13,848,841",135612346,85.7293%
"10,000.00 ^ 14,999.99","12,329,270",121763505,76.9745%
"15,000.00 ^ 19,999.99","11,505,776",109434235,69.1804%
"20,000.00 ^ 24,999.99","10,918,555",97928459,61.9069%
"25,000.00 ^ 29,999.99","10,192,863",87009904,55.0045%
"30,000.00 ^ 34,999.99","9,487,840",76817041,48.5610%
"35,000.00 ^ 39,999.99","8,578,215",67329201,42.5631%
"40,000.00 ^ 44,999.99","7,553,972",58750986,37.1403%
"45,000.00 ^ 49,999.99","6,542,882",51197014,32.3649%
"50,000.00 ^ 54,999.99","5,723,269",44654132,28.2287%
"55,000.00 ^ 59,999.99","4,846,517",38930863,24.6107%
"60,000.00 ^ 64,999.99","4,201,232",34084346,21.5469%
"65,000.00 ^ 69,999.99","3,573,471",29883114,18.8910%
"70,000.00 ^ 74,999.99","3,094,739",26309643,16.6320%
"75,000.00 ^ 79,999.99","2,684,481",23214904,14.6756%
"80,000.00 ^ 84,999.99","2,297,338",20530423,12.9786%
"85,000.00 ^ 89,999.99","1,975,400",18233085,11.5263%
"90,000.00 ^ 94,999.99","1,714,370",16257685,10.2775%
"95,000.00 ^ 99,999.99","1,486,636",14543315,9.1938%
"100,000.00 ^ 104,999.99","1,309,068",13056679,8.2540%
"105,000.00 ^ 109,999.99","1,117,128",11747611,7.4264%
"110,000.00 ^ 114,999.99","977,055",10630483,6.7202%
"115,000.00 ^ 119,999.99","865,889",9653428,6.1026%
"120,000.00 ^ 124,999.99","773,339",8787539,5.5552%
"125,000.00 ^ 129,999.99","673,971",8014200,5.0663%
"130,000.00 ^ 134,999.99","595,827",7340229,4.6402%
"135,000.00 ^ 139,999.99","527,341",6744402,4.2636%
"140,000.00 ^ 144,999.99","466,992",6217061,3.9302%
"145,000.00 ^ 149,999.99","419,003",5750069,3.6350%
"150,000.00 ^ 154,999.99","384,581",5331066,3.3701%
"155,000.00 ^ 159,999.99","335,391",4946485,3.1270%
"160,000.00 ^ 164,999.99","296,048",4611094,2.9150%
"165,000.00 ^ 169,999.99","265,309",4315046,2.7278%
"170,000.00 ^ 174,999.99","239,515",4049737,2.5601%
"175,000.00 ^ 179,999.99","216,255",3810222,2.4087%
"180,000.00 ^ 184,999.99","200,592",3593967,2.2720%
"185,000.00 ^ 189,999.99","179,005",3393375,2.1452%
"190,000.00 ^ 194,999.99","165,277",3214370,2.0320%
"195,000.00 ^ 199,999.99","154,070",3049093,1.9275%
"200,000.00 ^ 249,999.99","1,039,897",2895023,1.8301%
"250,000.00 ^ 299,999.99","565,105",1855126,1.1727%
"300,000.00 ^ 349,999.99","333,584",1290021,0.8155%
"350,000.00 ^ 399,999.99","219,923",956437,0.6046%
"400,000.00 ^ 449,999.99","151,162",736514,0.4656%
"450,000.00 ^ 499,999.99","108,881",585352,0.3700%
"500,000.00 ^ 999,999.99","345,935",476471,0.3012%
"1,000,000.00 ^ 1,499,999.99","65,548",130536,0.0825%
"1,500,000.00 ^ 1,999,999.99","24,140",64988,0.0411%
"2,000,000.00 ^ 2,499,999.99","12,137",40848,0.0258%
"2,500,000.00 ^ 2,999,999.99","6,871",28711,0.0182%
"3,000,000.00 ^ 3,499,999.99","4,799",21840,0.0138%
"3,500,000.00 ^ 3,999,999.99","3,258",17041,0.0108%
"4,000,000.00 ^ 4,499,999.99","2,353",13783,0.0087%
"4,500,000.00 ^ 4,999,999.99","1,822",11430,0.0072%
"5,000,000.00 ^ 9,999,999.99","6,468",9608,0.0061%
"10,000,000.00 ^ 19,999,999.99","2,230",3140,0.0020%
"20,000,000.00 ^ 49,999,999.99",776,910,0.0006%
"50,000,000.00 and over",134,134,0.0001%</div>
